<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>[æ—¥å…‰åœ˜éšŠ] æ„›æ¨‚å”¯ 90å¤©è¡Œå‹•è¨ˆç•« - æ·±åº¦æ•´åˆæœ€çµ‚ç‰ˆ</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
/* æ ¸å¿ƒæ¨£å¼ */
body{font-family:"Noto Sans TC",system-ui,-apple-system,Segoe UI,Roboto;margin:0;background:linear-gradient(180deg,#fff4e6,#ffe8d0);color:#33231a; min-height: 100vh;}
.brand{display:flex;align-items:center;gap:12px;padding:16px 20px;background:#ffcf99;border-bottom:1px solid #f5b780; position:sticky; top:0; z-index:100;}
.brand img{width:52px;height:52px;object-fit:contain}
.brand .name{font-weight:800;font-size:18px}
.container{max-width:960px;margin:0 auto;padding:16px}
.card{background:#fffaf3;border-radius:16px;box-shadow:0 10px 30px rgba(198,120,64,.15);padding:16px;border:1px solid #ffd4ad; margin-bottom: 20px;}
.row{display:flex;gap:12px;flex-wrap:wrap}
.col{flex:1 1 200px}
.title{font-weight:800;font-size:20px;margin:0 0 8px;color:#7a3a10}
.muted{color:#7b6a5f;font-size:14px}
.input{width:100%;padding:10px 12px;border:1px solid #e6b98e;border-radius:10px;background:#fff;font-size:16px; box-sizing: border-box;}
.btn{display:inline-flex;align-items:center;justify-content:center;background:#ea8a37;color:#fff;border:none;border-radius:12px;padding:12px 14px;font-weight:700;font-size:16px;cursor:pointer; transition: 0.3s;}
.btn:hover{background:#d4762a; opacity: 0.9;}
.pill{display:inline-block;background:#fff3e6;color:#c45a12;padding:6px 10px;border-radius:999px;font-size:14px;border:1px solid #ffd0a6; font-weight: bold;}
.countdown{font-weight:800;font-size:24px;color:#c62828}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px; margin-top:12px}
.cal-cell{background:#fff;border:1px solid #ffd4ad;border-radius:10px;min-height:48px;display:flex;align-items:center;justify-content:center;color:#6a2f0a;font-weight:700}
.cal-today{border:2px solid #ea8a37;background:#fff8ef;color:#ea8a37}
.deck{display:flex;gap:12px}
.card-item{flex:1;background:#fff;border:2px dashed #ffd0a6;border-radius:16px;padding:16px;min-height:120px;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:800;cursor:pointer;color:#6a2f0a; text-align: center; transition: 0.2s;}
.card-item.revealed{border:2px solid #ea8a37;background:#fff8ef; cursor: default;}

/* åœ–ç‰‡åˆ—æ¨£å¼ */
.img-row{display:flex;gap:12px;flex-wrap:wrap; margin-bottom: 20px;}
.img-card{background: #fff; border-radius: 12px; padding: 10px; border: 1px solid #ffd4ad; flex: 1 1 280px; text-align: center;}
.img-card img{width:100%; height:auto; border-radius: 8px; margin-top: 8px; border: 1px solid #ddd;}
.img-card .img-title{font-weight: 800; color: #7a3a10; font-size: 14px;}

/* è³‡æºå¡ç‰‡æ¨£å¼ */
.resource-card { background: #f3fff6; border: 1px solid #cfead5; margin-top: 20px; }
.resource-links { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 10px; }
.resource-links a { display: inline-flex; align-items: center; gap: 6px; color: #2e7d32; text-decoration: none; font-weight: 800; font-size: 14px; }
.resource-links a:hover { opacity: 0.8; }
.icon { width: 18px; height: 18px; }

/* å½ˆçª—æ¨£å¼ */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center; z-index: 2000;}
.modal{background:#fffaf3;border-radius:16px;max-width:420px;width:90%;padding:25px;border:1px solid #ffd4ad; text-align: center;}
.textarea{width:100%;min-height:80px;padding:10px 12px;border:1px solid #e6b98e;border-radius:10px;font-size:14px;background:#fff; font-family: inherit;}

/* åå–®è† å›Šæ¨£å¼ */
.name-pill {
    display: inline-flex; align-items: center; background: #fffaf3; color: #8a2a2a; 
    border: 1px solid #ffd4ad; border-radius: 999px; padding: 6px 10px 6px 14px; 
    font-weight: 800; font-size: 14px; cursor: pointer; gap: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
.name-pill .del-btn {
    width: 22px; height: 22px; background: rgba(0,0,0,0.08); 
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-size: 16px; transition: 0.2s;
}
.name-pill .del-btn:hover { background: #c62828; color: #fff; }

/* Dan Koe é¢¨æ ¼çµ„ä»¶ */
.identity-banner { background: #7a3a10; color: #fff; padding: 16px; border-radius: 16px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(122,58,16,0.3); }
.anti-vision-alert { background: #fff0f0; border-left: 5px solid #c62828; padding: 10px; border-radius: 8px; margin-top: 10px; }
.card-dark { background: #33231a; color: #fffaf3; border: none; }
.card-dark .title { color: #ffcf99; }
</style>
</head>
<body>

<div class="brand">
  <img src="sunlightlogo.png" alt="æ—¥å…‰" onerror="this.src='https://cdn-icons-png.flaticon.com/512/869/869869.png'"/>
  <div class="name">æ—¥å…‰æ„›æ¨‚å”¯Â· 90å¤©è›»è®Šæ—…ç¨‹</div>
</div>

<div class="container">
  <!-- å•Ÿå‹•è¦–åœ– (Start Page) -->
  <div id="view-start">
    <div class="card">
        <div class="title">é¸æ“‡ä½ çš„ 90 å¤©è›»è®Šè¨ˆç•«</div>
        <div class="muted">åœ¨å•Ÿå‹•å‰ï¼Œè«‹å…ˆç¢ºèªä½ çš„ç›®æ¨™èˆ‡å°æ‡‰è¨ˆç•«åœ–</div>
        <div style="height:15px"></div>
        
        <div class="img-row">
            <div class="img-card">
                <div class="img-title">ğŸ›’ æ¶ˆè²»è€…ï¼šè³ºå¥åº·</div>
                <img src="consumer_plan.png.png" alt="æ¶ˆè²»è€…è¨ˆç•«" onerror="this.style.display='none'; this.after(' [åœ–è¡¨ï¼šconsumer_plan.png.png] ')"/>
            </div>
            <div class="img-card">
                <div class="img-title">ğŸ“¢ åˆ†äº«è€…ï¼šæœˆå…¥1~5è¬</div>
                <img src="sharer_plan.png.png" alt="åˆ†äº«è€…è¨ˆç•«" onerror="this.style.display='none'; this.after(' [åœ–è¡¨ï¼šsharer_plan.png.png] ')"/>
            </div>
            <div class="img-card">
                <div class="img-title">ğŸ’ ç¶“ç‡Ÿè€…ï¼šæœˆå…¥5~30è¬</div>
                <img src="operator_plan.png.png" alt="ç¶“ç‡Ÿè€…è¨ˆç•«" onerror="this.style.display='none'; this.after(' [åœ–è¡¨ï¼šoperator_plan.png.png] ')"/>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="title">è¼¸å…¥å•Ÿå‹•åƒæ•¸</div>
        <div class="row">
            <div class="col"><input id="nickname" class="input" placeholder="å§“å" /></div>
            <div class="col"><input id="rankTarget" class="input" placeholder="90å¤©è›»è®Šç›®æ¨™" /></div>
        </div>
        
        <div style="height:12px"></div>
        <div class="row">
          <div class="col"><input id="pv30" class="input" placeholder="30å¤© PV" /></div>
          <div class="col"><input id="pv60" class="input" placeholder="31~60å¤© PV" /></div>
          <div class="col"><input id="pv90" class="input" placeholder="61~90å¤© PV" /></div>
        </div>

        <div style="height:15px"></div>
        <div class="muted">å¥åº·è¨ˆç•«é¡å‹</div>
        <div class="row" style="margin-top:8px">
          <div class="col">
            <label class="input" style="display:flex;align-items:center;gap:8px">
              <input type="radio" name="healthPlanType" value="å¿«é€Ÿç˜¦" checked /> å¿«é€Ÿç˜¦
            </label>
          </div>
          <div class="col">
            <label class="input" style="display:flex;align-items:center;gap:8px">
              <input type="radio" name="healthPlanType" value="å¿«æ¨‚ç˜¦" /> å¿«æ¨‚ç˜¦
            </label>
          </div>
        </div>
        <div style="height:12px"></div>
        <div class="row">
          <div class="col"><input id="hp30" class="input" placeholder="30å¤©å¥åº·ç›®æ¨™?å…¬æ–¤" /></div>
          <div class="col"><input id="hp60" class="input" placeholder="31~60å¤©å¥åº·ç›®æ¨™?å…¬æ–¤" /></div>
          <div class="col"><input id="hp90" class="input" placeholder="61~90å¤©å¥åº·ç›®æ¨™?å…¬æ–¤" /></div>
        </div>

        <div style="height:25px"></div>
        <div class="section-title" style="color: #c62828;">ğŸš© Dan Koe åé¡˜æ™¯ï¼šå¤±æ•—å¾Œçš„æœªä¾†ï¼Ÿ</div>
        <textarea id="antiVision" class="textarea" placeholder="æè¿°å¦‚æœä½ åœæ­¢æˆé•·ï¼Œä¸‰å¹´å¾Œé‚£å€‹ä»¤ä½ å­æƒ¡ã€æ…˜ç—›çš„äººç”Ÿæ¨£è²Œ..."></textarea>
        
        <div style="height:15px"></div>
        <div class="section-title" style="color: #2e7d32;">âœ¨ èº«åˆ†å®£è¨€ï¼šä½ æƒ³æˆç‚ºèª°ï¼Ÿ</div>
        <textarea id="identityGoal" class="textarea" placeholder="ä¾‹å¦‚ï¼šæˆ‘æ˜¯ä¸€å€‹è‡´åŠ›æ–¼æ¨å»£å¥åº·ã€æ¯æ—¥ç©©å®šç”¢å‡ºåƒ¹å€¼çš„é ˜è¢–ã€‚"></textarea>

        <div style="height:30px"></div>
        <button id="startBtn" class="btn" style="width: 100%; font-size: 18px;">å•Ÿå‹•èº«åˆ†è½‰å‘ä¸¦é–‹å§‹è¡Œå‹•</button>
    </div>
  </div>

  <!-- æ¯æ—¥åŸ·è¡Œè¦–åœ– (Daily View) -->
  <div id="view-daily" style="display:none">
    
    <!-- èº«åˆ†èˆ‡å¿ƒæ™ºéšæ®µæ©«å¹… -->
    <div class="identity-banner">
        <div style="font-size: 12px; opacity: 0.8;">ç•¶å‰èº«åˆ†èªåŒï¼š</div>
        <div id="displayIdentity" style="font-size: 18px; font-weight: 800; margin: 4px 0;"></div>
        <div id="mindsetStage" style="font-size: 11px; background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 4px; display: inline-block;"></div>
    </div>

    <!-- è¨ˆç•«åƒè€ƒåœ–ï¼šæ¯å¤©éƒ½çœ‹å¾—åˆ° -->
    <div class="card">
        <div class="section-title">ğŸ—ºï¸ 90å¤©è¨ˆç•«è—åœ–åƒè€ƒ</div>
        <div class="muted">éš¨æ™‚æ ¸å°ä½ çš„éšæ®µæ€§ä»»å‹™</div>
        <div style="height:10px"></div>
        <div class="img-row" style="margin-bottom: 0;">
            <div class="img-card" style="flex: 1 1 150px; border: 1px solid #ffd4ad;">
                <div class="img-title" style="font-size:12px;">ğŸ›’ æ¶ˆè²»è€…</div>
                <img src="consumer_plan.png.png" alt="æ¶ˆè²»è€…" onerror="this.style.display='none'; this.after('[åœ–]')"/>
            </div>
            <div class="img-card" style="flex: 1 1 150px; border: 1px solid #ffd4ad;">
                <div class="img-title" style="font-size:12px;">ğŸ“¢ åˆ†äº«è€…</div>
                <img src="sharer_plan.png.png" alt="åˆ†äº«è€…" onerror="this.style.display='none'; this.after('[åœ–]')"/>
            </div>
            <div class="img-card" style="flex: 1 1 150px; border: 1px solid #ffd4ad;">
                <div class="img-title" style="font-size:12px;">ğŸ’ ç¶“ç‡Ÿè€…</div>
                <img src="operator_plan.png.png" alt="ç¶“ç‡Ÿè€…" onerror="this.style.display='none'; this.after('[åœ–]')"/>
            </div>
        </div>
    </div>

    <!-- æ•¸æ“šæ¦‚è¦½èˆ‡åé¡˜æ™¯ -->
    <div class="card">
        <div class="row">
          <div class="col">
            <div class="title">ç¬¬ <span id="dayNum"></span> å¤©ï¼é€²åŒ–ä¹‹æ—…</div>
            <div class="muted">å§“åï¼š<span id="nicknameLabel"></span>ï½œç›®æ¨™ï¼š<span id="rankLabel"></span></div>
            <div class="muted">PVï¼š<span id="pv30Label"></span> / <span id="pv60Label"></span> / <span id="pv90Label"></span></div>
            <div class="muted">å¥åº·ï¼š<span id="healthPlanLabel"></span> (<span id="hp30Label"></span> / <span id="hp60Label"></span> / <span id="hp90Label"></span>)</div>
            
            <div class="anti-vision-alert">
                <div style="font-size: 11px; color: #c62828; font-weight: 900;">âš ï¸ åé¡˜æ™¯ï¼šæ‹’çµ•æ·ªç‚º...</div>
                <div id="displayAntiVision" style="font-size: 13px; font-style: italic;"></div>
            </div>
            
            <div style="height:15px"></div>
            <span id="statusPill" class="pill">ä»Šæ—¥å°šæœªè¦ºå¯Ÿ</span>
          </div>
          <div class="col" style="text-align:right">
            <div class="muted">é–‹å§‹ï¼š<span id="startDate"></span></div>
            <div class="muted">çµæŸï¼š<span id="endDate"></span></div>
            <div style="height:10px"></div>
            <div class="countdown"><span id="countdownNum"></span></div>
            <div class="muted">å‰©é¤˜å¤©æ•¸</div>
            <button id="resetBtn" class="btn" style="background:#8a2a2a; font-size: 11px; margin-top:15px; padding: 6px 10px;">é‡è¨­ç³»çµ±</button>
          </div>
        </div>
    </div>

    <div class="deck">
      <div id="cardHumor" class="card-item">ğŸ­<br>æ¯æ—¥ä¸€æŠ½[å¯é‡è¤‡]</div>
      <div id="cardKnowledge" class="card-item">ğŸ’¡<br>90å¤©èƒ½é‡æŒ‡å¼•</div>
      <div id="cardAction" class="card-item">ğŸš€<br>ä»Šæ—¥èªçŸ¥</div>
    </div>

    <!-- åå–®è·Ÿé€² -->
    <div id="followupManageCard" class="card card-pink">
      <div class="section-title">ğŸ‘¥ åå–®è·Ÿé€²ç®¡ç†</div>
      <div style="display: flex; gap: 8px;">
        <input id="nameInput" class="input" placeholder="å¤¥ä¼´å§“å..." />
        <select id="nameType" class="input" style="flex: 0 0 100px;">
            <option value="builder">ç¶“ç‡Ÿè€…</option>
            <option value="customer">æ¶ˆè²»è€…</option>
        </select>
        <button id="addNameBtn" class="btn">æ·»åŠ </button>
      </div>
      <div id="namesDisplay" class="names-container"></div>
      <p class="muted" style="font-size: 11px; margin-top: 15px;">ğŸ’¡ é»æ“Šåå­—å¯«ç­†è¨˜ï¼›é»æ“Šã€ŒÃ—ã€åˆªé™¤åå–®ã€‚</p>
    </div>

    <div id="calendarCard" class="card">
      <div class="section-title">é‡æ§‹æ—¥æ›†</div>
      <div id="calendar" class="cal-grid"></div>
    </div>

    <!-- è¡Œå‹•è¨ˆç•«å¡ç‰‡ (æ™ºæ…§å›å¡«) -->
    <div id="planInputCard" class="card card-blue">
      <div class="section-title">ğŸ“… è¡Œå‹•è¨ˆç•«ç´€éŒ„</div>
      <div class="row">
        <div class="col"><input id="planDate" class="input" type="date" /></div>
        <div class="col"><input id="planTarget" class="input" placeholder="ä»Šæ—¥ç¸½ç›®æ¨™" /></div>
      </div>
      <div style="height:10px"></div>
      <div class="row">
        <div class="col"><input id="planTime1" class="input" type="time" /></div>
        <div class="col"><input id="planAction1" class="input" placeholder="å…·é«”è¡Œå‹•å…§å®¹" /></div>
      </div>
      <div style="height:15px"></div>
      <button id="addPlanBtn" class="btn" style="width:100%">æ–°å¢ç•¶æ—¥è¨ˆç•«å¡ç‰‡</button>
    </div>
    <div id="planCards" class="cards"></div>

    <!-- Dan Koe å¤œæ™šå€ -->
    <div class="card card-dark">
      <div class="section-title">ğŸŒ™ ç¡å‰å¾©ç›¤</div>
      <div class="muted" style="color:#d1c4bc">ä»Šå¤©æœ‰æ²’æœ‰ã€Œå…§åœ¨æ¨¡å¼ã€é˜»ç¤™äº†æˆ‘ï¼Ÿè€Œéæ€ªç½ªç’°å¢ƒã€‚</div>
      <textarea id="enemyInsight" class="textarea" style="background:#4a3b32; color:#fff; border:none; margin-top:10px;" placeholder="ä¾‹å¦‚ï¼šæˆ‘ä»Šå¤©çš„æ•µäººæ˜¯ã€è¿½æ±‚å®‰å…¨æ„Ÿçš„é€ƒé¿ã€..."></textarea>
      <button id="saveInsightBtn" class="btn" style="background:#ffcf99; color:#33231a; width:100%; margin-top:10px;">å£“ç¸®ä»Šæ—¥æ´å¯Ÿ</button>
    </div>
  </div>

  <!-- é å°¾æ©«å¼è³‡æºå¡ç‰‡ -->
  <div class="card resource-card">
    <div class="section-title" style="color:#2e7d32; font-size:16px;">ğŸŒ æ—¥å…‰è³‡æº</div>
    <div class="resource-links">
        <a href="https://www.facebook.com/alfawise.world" target="_blank">
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M22 12a10 10 0 1 0-11.6 9.9v-7H7v-3h3.4V9.5c0-3.3 2-5.1 5-5.1 1.4 0 2.8.3 2.8.3v3h-1.6c-1.6 0-2.1 1-2.1 2V12h3.6l-.6 3h-3v7A10 10 0 0 0 22 12Z"/></svg>
            FB
        </a>
        <a href="https://alfawise.world" target="_blank">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
            å®˜ç¶²
        </a>
        <a href="https://ai168.tw" target="_blank">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            åº—å®¶äº’è¯
        </a>
    </div>
  </div>

  <div class="footer">Â© æ—¥å…‰åœ˜éšŠ90å¤©æ¶ˆè²»å…±ç‡Ÿè¨ˆç•« Â· ç‰ˆæ¬Šæ‰€æœ‰.mataè¨­è¨ˆ</div>
</div>

<!-- å½ˆçª—æ¨¡çµ„ï¼šç¢ºèªåˆªé™¤ -->
<div id="confirmModal" class="modal-backdrop">
    <div class="modal">
      <div class="title">ç¢ºèªç§»é™¤æ­¤å¤¥ä¼´ï¼Ÿ</div>
      <div style="height:20px"></div>
      <div class="row">
        <div class="col"><button id="confirmYes" class="btn" style="width:100%">ç¢ºå®š</button></div>
        <div class="col"><button id="confirmNo" class="btn" style="width:100%;background:#8a2a2a">å–æ¶ˆ</button></div>
      </div>
    </div>
</div>

<!-- å½ˆçª—æ¨¡çµ„ï¼šè·Ÿé€²ç­†è¨˜ -->
<div id="noteModal" class="modal-backdrop">
    <div class="modal">
      <div class="title" id="noteTitle">è·Ÿé€²ç´€éŒ„</div>
      <textarea id="noteText" class="textarea" style="min-height: 200px; margin-top: 10px;" placeholder="åœ¨æ­¤è¨˜éŒ„æºé€šé€²åº¦..."></textarea>
      <div class="row" style="margin-top:15px">
        <div class="col"><button id="saveNoteBtn" class="btn" style="width:100%">å„²å­˜</button></div>
        <div class="col"><button id="closeNoteBtn" class="btn" style="width:100%;background:#8a2a2a">é—œé–‰</button></div>
      </div>
    </div>
</div>

<!-- å½ˆçª—æ¨¡çµ„ï¼šDan Koe ç™½å¤©è¦ºå¯Ÿ -->
<div id="patternModal" class="modal-backdrop">
    <div class="modal">
      <div style="font-size: 40px;">ğŸ”</div>
      <div class="title" style="color: #ea8a37;">èº«åˆ†è¦ºå¯Ÿæ™‚åˆ»</div>
      <div id="patternQuestion" style="font-size: 18px; font-weight: 700; line-height: 1.6; margin: 15px 0;"></div>
      <p class="muted">æš«åœ 10 ç§’ï¼Œèª å¯¦çš„é¢å°ä½ çš„å¤§è…¦ã€‚</p>
      <button id="closePatternBtn" class="btn" style="width:100%; margin-top:15px">æˆ‘å·²è¦ºå¯Ÿï¼Œç¹¼çºŒå‰µé€ </button>
    </div>
</div>

<script id="presetData" type="application/json">
{
  "actions": ["ç¬¬1å¤©ï¼šèªæ¸…ç›´éŠ·çš„æœ¬è³ªâ€”åˆ†äº«åƒ¹å€¼", "ç¬¬2å¤©ï¼šè¨­å®šä½ çš„90å¤©ç›®æ¨™", "ç¬¬3å¤©ï¼šç†Ÿæ‚‰å…¬å¸èƒŒæ™¯èˆ‡åˆ¶åº¦", "ç¬¬4å¤©ï¼šå»ºç«‹ä½ çš„å€‹äººæ•…äº‹", "ç¬¬5å¤©ï¼šåˆ—å‡ºä½ äººç”Ÿ5å¤§å‹•åŠ›", "ç¬¬6å¤©ï¼šç†è§£è¤‡è£½çš„é‡è¦æ€§", "ç¬¬7å¤©ï¼šå»ºç«‹å¿…è¬›è©±è¡“", "ç¬¬8å¤©ï¼šäº†è§£ç”¢å“æ ¸å¿ƒåƒ¹å€¼", "ç¬¬9å¤©ï¼šå­¸æœƒèªªäººè©±", "ç¬¬10å¤©ï¼šæ¯å¤©ä½¿ç”¨ç”¢å“"],
  "knowledge": ["ç¬¬1å¤©ï¼šä»Šå¤©é–‹å§‹ï¼Œæˆ‘é¸æ“‡æˆç‚ºæ›´å¥½çš„è‡ªå·±", "ç¬¬2å¤©ï¼šçœŸæ­£èƒ½æ”¹è®Šäººç”Ÿçš„ï¼Œæ˜¯æ¯å¤©çš„è¡Œå‹•", "ç¬¬3å¤©ï¼šæˆåŠŸä¸é é‹æ°£ï¼Œé æŒçºŒå‡ºç¾", "ç¬¬4å¤©ï¼šæˆ‘æœ‰èƒ½åŠ›å­¸æœƒä»»ä½•æŠ€èƒ½", "ç¬¬5å¤©ï¼šæ¯ä¸€æ¬¡åˆ†äº«éƒ½è®“æˆ‘æ¥è¿‘ç›®æ¨™"]
}
</script>

<script>
/**
 * å…¨æ–¹ä½ç³»çµ±æ•´åˆé‚è¼¯
 */
const S={
    get(k){try{const v=localStorage.getItem(k); return v?JSON.parse(v):null}catch(e){return null}},
    set(k,v){localStorage.setItem(k,JSON.stringify(v))},
    del(k){localStorage.removeItem(k)}
};

const K="dlp.nickname", D="dlp.startDate", R="dlp.rankTarget", KCARDS="dlp.planCards", INSIGHTS="dlp.insights";
const PV30="dlp.pv30", PV60="dlp.pv60", PV90="dlp.pv90";
const HMAIN="dlp.health", HP30="dlp.hp30", HP60="dlp.hp60", HP90="dlp.hp90";

const HUMOR_LINES=["ä»Šå¤©ä¸å®Œç¾ï¼Œä½†æˆ‘å¾ˆå¯æ„›", "å¤±æ•—ä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯æ²’ç¬‘å®¹", "æ¸›è‚¥ä¸é›£ï¼Œæˆ‘æœ‰é¤é‡ç®¡ç†+ç¥é£²", "åšè‡ªå·±ç‰ˆæœ¬çš„ä¸»è§’", "è¦æŠŠå¯æ„›ç™¼çµ¦ä¸–ç•Œ", "ä¿æŒå¹½é»˜ï¼Œä½ çš„åŠªåŠ›æœƒè¢«çœ‹è¦‹"];
const DAN_KOE_QS = ["ã€Œæˆ‘ç¾åœ¨é€™ä»¶äº‹æ˜¯åœ¨é€ƒé¿ä»€éº¼ï¼Ÿã€", "ã€Œæˆ‘æ­£åœ¨é è¿‘æˆ‘è¨å­çš„ç”Ÿæ´»ï¼Œé‚„æ˜¯æˆ‘æƒ³è¦çš„ç”Ÿæ´»ï¼Ÿã€", "ã€Œæˆ‘åœ¨å“ªäº›åœ°æ–¹ç”¨å®‰å…¨æ„Ÿäº¤æ›äº†æ´»è‘—çš„æ„Ÿè¦ºï¼Ÿã€"];

function dayNumber(){
    const startTs = S.get(D);
    if(!startTs) return null;
    return Math.max(1, Math.min(90, Math.floor((Date.now() - startTs) / 86400000) + 1));
}

function triggerPatternBreak() {
    const now = new Date();
    const h = now.getHours();
    if ((h >= 11 && h <= 12) || (h >= 15 && h <= 16)) {
        const last = S.get('dlp.lastCheck');
        if (last !== now.toDateString()) {
            const qEl = document.getElementById('patternQuestion');
            if (qEl) qEl.textContent = DAN_KOE_QS[Math.floor(Math.random()*DAN_KOE_QS.length)];
            const modal = document.getElementById('patternModal');
            if (modal) modal.style.display = 'flex';
            S.set('dlp.lastCheck', now.toDateString());
        }
    }
}

function renderLists(){
    const container = document.getElementById("namesDisplay");
    if(!container) return;
    const bs = S.get('dlp.builders') || [];
    const cs = S.get('dlp.customers') || [];
    const build = (n, type, idx) => `
        <div class="name-pill" onclick="openNote('${type}', ${idx})" style="background:${type==='builder'?'#fff1f5':'#f1f7ff'}">
            <span>${typeof n === 'string' ? n : n.name}</span>
            <span style="font-size:10px; opacity:0.6">${type==='builder'?'ğŸ’':'ğŸ›’'}</span>
            <div class="del-btn" onclick="triggerDelete(event, '${type}', ${idx})">Ã—</div>
        </div>`;
    container.innerHTML = bs.map((n, i) => build(n, 'builder', i)).join("") + cs.map((n, i) => build(n, 'customer', i)).join("");
}

function renderPlanCards(){
    const el=document.getElementById("planCards");
    if (!el) return;
    const cards = S.get(KCARDS) || [];
    el.innerHTML = [...cards].reverse().map(c => `
        <div class="card card-blue">
            <div class="section-title" style="font-size:15px; margin-bottom:5px;">ğŸ“… ${c.date}</div>
            <div class="muted"><b>ç¸½ç›®æ¨™ï¼š</b>${c.target}</div>
            ${(c.items||[]).map(i=>`<div class="muted">ğŸ“ æ™‚é–“ï¼š${i.time} | è¡Œå‹•ï¼š${i.action}</div>`).join("")}
        </div>
    `).join("");
}

function renderCalendar(today){
    const container=document.getElementById("calendar");
    if (!container) return;
    const nowDate=new Date();
    const y=nowDate.getFullYear(), m=nowDate.getMonth();
    const first=new Date(y, m, 1), last=new Date(y, m+1, 0);
    const days=last.getDate(), startDow=first.getDay();
    let html=`<div class="cal-header" style="color:#7a3a10; font-weight:800;"><div>${y}/${m+1}</div></div><div class="cal-grid">`;
    const dows=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"];
    html += dows.map(d=>`<div class="cal-cell" style="background:#fff8ef; font-size:12px; font-weight:800; border-color:#ffd4ad;">${d}</div>`).join("");
    for(let i=0; i<startDow; i++) html += `<div class="cal-cell" style="border:none"></div>`;
    for(let d=1; d<=days; d++){
        const isToday = (nowDate.getDate()===d);
        html += `<div class="cal-cell ${isToday?'cal-today':''}">${d}</div>`;
    }
    container.innerHTML = html + "</div>";
}

function render(){
    const start=S.get(D), nick=S.get(K);
    const vStart=document.getElementById("view-start"), vDaily=document.getElementById("view-daily");
    if(!start || !nick){
        if (vStart) vStart.style.display="";
        if (vDaily) vDaily.style.display="none";
        return;
    }
    if (vStart) vStart.style.display="none";
    if (vDaily) vDaily.style.display="";
    
    const d = dayNumber();
    const dnEl = document.getElementById("dayNum"); if(dnEl) dnEl.textContent = d;
    const nlEl = document.getElementById("nicknameLabel"); if(nlEl) nlEl.textContent = nick;
    const rlEl = document.getElementById("rankLabel"); if(rlEl) rlEl.textContent = S.get(R);
    
    const pv30El = document.getElementById("pv30Label"); if(pv30El) pv30El.textContent = S.get(PV30)||"0";
    const pv60El = document.getElementById("pv60Label"); if(pv60El) pv60El.textContent = S.get(PV60)||"0";
    const pv90El = document.getElementById("pv90Label"); if(pv90El) pv90El.textContent = S.get(PV90)||"0";
    
    const hpEl = document.getElementById("healthPlanLabel"); if(hpEl) hpEl.textContent = S.get(HMAIN)||"æœªé¸";
    const hp30El = document.getElementById("hp30Label"); if(hp30El) hp30El.textContent = S.get(HP30)||"";
    const hp60El = document.getElementById("hp60Label"); if(hp60El) hp60El.textContent = S.get(HP60)||"";
    const hp90El = document.getElementById("hp90Label"); if(hp90El) hp90El.textContent = S.get(HP90)||"";
    
    const sd = new Date(start);
    const sdEl = document.getElementById("startDate"); if(sdEl) sdEl.textContent = `${sd.getFullYear()}/${sd.getMonth()+1}/${sd.getDate()}`;
    const ed = new Date(start + 89*86400000);
    const edEl = document.getElementById("endDate"); if(edEl) edEl.textContent = `${ed.getFullYear()}/${ed.getMonth()+1}/${ed.getDate()}`;
    const cdEl = document.getElementById("countdownNum"); if(cdEl) cdEl.textContent = 90 - d + 1;
    
    const idEl = document.getElementById('displayIdentity'); if(idEl) idEl.textContent = S.get('dlp.identity') || "æœªè¨­å®šèº«åˆ†";
    const avEl = document.getElementById('displayAntiVision'); if(avEl) avEl.textContent = S.get('dlp.antiVision') || "æœªè¨­å®šåé¡˜æ™¯";
    
    const stages = ["è¡å‹•å‹", "è‡ªæˆ‘ä¿è­·å‹", "å¾çœ¾å‹", "è‡ªæˆ‘è¦ºå¯Ÿå‹", "è‡ªå¾‹è‰¯çŸ¥å‹", "å€‹é«”ä¸»ç¾©å‹", "ç­–ç•¥å‹", "å»ºæ§‹è¦ºå¯Ÿå‹", "åˆä¸€å‹"];
    const msEl = document.getElementById('mindsetStage'); if(msEl) msEl.textContent = `å¿ƒæ™ºé€²åŒ–éšç´šï¼š${stages[Math.min(Math.floor((d-1)/10), 8)]}`;

    const cardH = document.getElementById("cardHumor");
    if(cardH) cardH.onclick=()=>{ cardH.textContent=HUMOR_LINES[Math.floor(Math.random()*HUMOR_LINES.length)]; cardH.classList.add("revealed") };
    
    const data = JSON.parse(document.getElementById("presetData").textContent);
    const cardK = document.getElementById("cardKnowledge");
    if(cardK) cardK.onclick=()=>{ cardK.textContent=data.knowledge[d-1] || "èƒ½é‡æ³¨å…¥ä¸­..."; cardK.classList.add("revealed") };
    
    const cardA = document.getElementById("cardAction");
    if(cardA) cardA.onclick=()=>{ cardA.textContent=data.actions[d-1] || "è¡Œå‹•æ¸…å–®è¼‰å…¥ä¸­..."; cardA.classList.add("revealed") };

    renderLists();
    renderPlanCards();
    renderCalendar(d);
    triggerPatternBreak();
}

/**
 * åˆå§‹åŒ–
 */
window.onload = () => {
    const startBtn = document.getElementById("startBtn");
    if (startBtn) {
        startBtn.onclick = () => {
            const n=document.getElementById("nickname").value, r=document.getElementById("rankTarget").value;
            if(!n || !r) return alert("è«‹å¡«å¯«å§“åèˆ‡ç›®æ¨™è˜éšï¼");
            S.set(K, n); S.set(R, r); S.set(D, Date.now());
            S.set(PV30, document.getElementById("pv30").value); S.set(PV60, document.getElementById("pv60").value); S.set(PV90, document.getElementById("pv90").value);
            S.set(HP30, document.getElementById("hp30").value); S.set(HP60, document.getElementById("hp60").value); S.set(HP90, document.getElementById("hp90").value);
            const hp = document.querySelector('input[name="healthPlanType"]:checked');
            if(hp) S.set(HMAIN, hp.value);
            S.set('dlp.antiVision', document.getElementById('antiVision').value);
            S.set('dlp.identity', document.getElementById('identityGoal').value);
            render();
        };
    }

    const addPlanBtn = document.getElementById("addPlanBtn");
    if (addPlanBtn) {
        addPlanBtn.onclick = () => {
            const d=document.getElementById("planDate").value, t=document.getElementById("planTarget").value;
            const time=document.getElementById("planTime1").value, act=document.getElementById("planAction1").value;
            if(!d || !t || !act) return alert("è«‹å¡«å¯«æ—¥æœŸã€ç¸½ç›®æ¨™èˆ‡è¡Œå‹•å…§å®¹ï¼");
            const cards = S.get(KCARDS) || [];
            cards.push({date:d, target:t, items:[{time, action:act}]});
            S.set(KCARDS, cards);
            renderPlanCards();
            const actInput = document.getElementById("planAction1"); if(actInput) actInput.value = "";
            const timeInput = document.getElementById("planTime1"); if(timeInput) timeInput.value = "";
        };
    }

    const addBuilderBtn = document.getElementById("addBuilderBtn");
    if (addBuilderBtn) {
        addBuilderBtn.onclick = () => {
            const v = document.getElementById("builderInput").value; if(!v) return;
            const l = S.get('dlp.builders') || []; l.push({name:v, note:""}); S.set('dlp.builders', l);
            document.getElementById("builderInput").value = ""; renderLists();
        };
    }
    const addCustomerBtn = document.getElementById("addCustomerBtn");
    if (addCustomerBtn) {
        addCustomerBtn.onclick = () => {
            const v = document.getElementById("customerInput").value; if(!v) return;
            const l = S.get('dlp.customers') || []; l.push({name:v, note:""}); S.set('dlp.customers', l);
            document.getElementById("customerInput").value = ""; renderLists();
        };
    }

    const saveInsightBtn = document.getElementById("saveInsightBtn");
    if (saveInsightBtn) {
        saveInsightBtn.onclick = () => {
            const insights = S.get(INSIGHTS) || {};
            insights[new Date().toDateString()] = document.getElementById("enemyInsight").value;
            S.set(INSIGHTS, insights);
            alert("ä»Šæ—¥æ•µäººå·²å®šç¾©ï¼Œè¦ºå¯Ÿå·²ç”Ÿæ•ˆã€‚");
        };
    }

    const closePatternBtn = document.getElementById("closePatternBtn");
    if (closePatternBtn) closePatternBtn.onclick = () => { document.getElementById('patternModal').style.display='none'; };
    
    const closeNoteBtn = document.getElementById('closeNoteBtn');
    if (closeNoteBtn) closeNoteBtn.onclick = () => { document.getElementById('noteModal').style.display='none'; };

    const confirmNo = document.getElementById('confirmNo');
    if (confirmNo) confirmNo.onclick = () => { document.getElementById('confirmModal').style.display = 'none'; };

    const saveNoteBtn = document.getElementById('saveNoteBtn');
    if (saveNoteBtn) {
        saveNoteBtn.onclick = () => {
            const key = activeItem.type==='builder'?'dlp.builders':'dlp.customers';
            const list = S.get(key);
            list[activeItem.idx].note = document.getElementById('noteText').value;
            S.set(key, list);
            document.getElementById('noteModal').style.display='none';
        };
    }

    const confirmYes = document.getElementById('confirmYes');
    if (confirmYes) {
        confirmYes.onclick = () => {
            const key = pendingDel.type==='builder'?'dlp.builders':'dlp.customers';
            const list = S.get(key); list.splice(pendingDel.idx, 1); S.set(key, list);
            document.getElementById('confirmModal').style.display = 'none'; renderLists();
        };
    }

    const resetBtn = document.getElementById("resetBtn");
    if (resetBtn) resetBtn.onclick = () => { if(confirm("ç¢ºå®šé‡è¨­ç³»çµ±å—ï¼Ÿé€™æœƒæ¸…é™¤æ‰€æœ‰é€²åº¦ã€‚")) { localStorage.clear(); location.reload(); } };

    const dInput = document.getElementById("planDate");
    if (dInput) {
        dInput.value = new Date().toISOString().split('T')[0];
        dInput.onchange = (e) => {
            const cards = S.get(KCARDS) || [];
            const found = [...cards].reverse().find(c => c.date === e.target.value);
            if(found) document.getElementById("planTarget").value = found.target;
        };
    }

    render();
};

let activeItem = null;
function openNote(type, idx) {
    activeItem = { type, idx };
    const list = S.get(type==='builder'?'dlp.builders':'dlp.customers');
    document.getElementById('noteTitle').textContent = `è·Ÿé€²ç´€éŒ„ï¼š${list[idx].name}`;
    document.getElementById('noteText').value = list[idx].note || "";
    document.getElementById('noteModal').style.display='flex';
}

let pendingDel = null;
function triggerDelete(e, type, idx) {
    e.stopPropagation(); pendingDel = { type, idx };
    document.getElementById('confirmModal').style.display = 'flex';
}
</script>
</body>
</html>
